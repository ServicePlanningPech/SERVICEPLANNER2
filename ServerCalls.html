<script>
/* --------------------------------------------------------------------------------------*/
/* - Here are all the backend server calls                                              -*/
/* --------------------------------------------------------------------------------------*/

// Get Slide count for a presentation
function getSlideCount(presentationId) { 
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getSlideCount(presentationId);

    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

// Get thumbnail Urls for a presentation
function getThumbnailUrls(presentationId, folderId) { 
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getThumbnailUrls(presentationId, folderId);  // Note: Added folderId parameter

    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

// Get Service Plans
function getServicePlans()   { 
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getServicePlans();

    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

// Get Songs list from songs database
function getSongList()   { 
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getSongList();

    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function loadServiceOrder(folderId) {
    return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .loadServiceOrder(folderId);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function getFolderFileCount(folderId) {
    return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getFolderFileCount(folderId);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function createNewPlan(date, type) {
     return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .createNewPlan(date, type);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function deletePlan(selectedPlanId) {
     return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .deletePlan(selectedPlanId);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function saveOrder(currentSpreadsheetId, serviceOrder) {
   return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .saveOrder(currentSpreadsheetId, serviceOrder);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function uploadFile(file, filename, selectedPlanId, currentUploadType) {
   return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .fileUploader(file, filename, selectedPlanId, currentUploadType);
    function success(result) {
       resolve(result);
    }
    function failure(error) {
       reject(error);
    }
  });
}

function getSlideTemplates() {
   showLoading(true,"Looking for templates..");
   return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getSlideTemplates();
    function success(result) {
       showLoading(false);
       resolve(result);
    }
    function failure(error) {
       showLoading(false);
       reject(error);
    }
  });
}

function createSlidePresentation(name,folderId,templateId) {
   showLoading(true,"Creating Presentation");
   return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .createSlidePresentation(name, folderId,templateId);
    function success(result) {
       showLoading(false);
       resolve(result);
    }
    function failure(error) {
       showLoading(false);
       reject(error);
    }
  });
}

function copySongToServicePlan(sourceId, planFolderId, songName) {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .copySongToServicePlan(sourceId, planFolderId, songName);
      
    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function callGetSettings() {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .getSettings();
      
    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function getStorageInfo() {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(resolve)
      .withFailureHandler(reject)
      .getDriveStorageInfo();

    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function publishServicePlan(selectedPlanId) {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(resolve)
      .withFailureHandler(reject)
      .publishServicePlan(selectedPlanId);

    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function appendSlidesToPublication(itemId,presentationId,blankBefore,blankAfter) {
 return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(resolve)
      .withFailureHandler(reject)
      .appendSlidesToPublication(itemId,presentationId,blankBefore,blankAfter);

    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function sendServicePlanEmails(folderId) {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(resolve)
      .withFailureHandler(reject)
      .sendServicePlanEmails(folderId);
    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function getHowToContent(HowToId) {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(resolve)
      .withFailureHandler(reject)
      .getHowToContent(HowToId);
    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}

function checkNoticesFile(planDate) {
  showLoading(true,"Checking for existing notices...");
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .checkNoticesFile(planDate);

    function success(result) {
      showLoading(false);
      resolve(result);
    }
    function failure(error) {
      showLoading(false);
      reject(error);
    }
  });
}

function createNoticesFile(planDate) {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(success)
      .withFailureHandler(failure)
      .createNoticesFile(planDate);

    function success(result) {
      resolve(result);
    }
    function failure(error) {
      reject(error);
    }
  });
}


/* Here is a sample of how to call these functions
await getSlideCount(presentationId)
    .then(result => {
      slideCount = result;
       })
    .catch(error => {
        alert('Error:' + error);
       }); 

*/





/* --------------------------------------------------------------------------------------*/
/* -                                                                                    -*/
/* --------------------------------------------------------------------------------------*/
</script>
